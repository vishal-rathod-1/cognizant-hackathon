{% extends 'base.html' %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-md-7 col-lg-6">
    <div class="card p-4">
      <h4 class="mb-3"><i class="bi bi-key me-2"></i>Change Password</h4>
      <form method="post">
        
        <!-- Current password -->
        <div class="mb-3">
          <label class="form-label">Current password</label>
          <div class="input-group">
            <input id="oldPassword" class="form-control" type="password" name="old_password" required>
            <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('oldPassword', this)">
              <i class="bi bi-eye"></i>
            </button>
          </div>
        </div>

        <!-- New password -->
        <div class="mb-3">
          <label class="form-label">New password</label>
          <div class="input-group">
            <input id="newPassword" class="form-control" type="password" name="new_password" required>
            <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('newPassword', this)">
              <i class="bi bi-eye"></i>
            </button>
          </div>
        </div>

        <button class="btn btn-brand w-100" type="submit">Update Password</button>
      </form>

      <div class="small muted mt-3">
        On change, all your PII entries are decrypted in memory with your old key and re-encrypted with a new key derived from your new password. Nonces are rotated.
      </div>
    </div>
  </div>
</div>

<script>
function togglePassword(fieldId, btn) {
  const field = document.getElementById(fieldId);
  const icon = btn.querySelector("i");
  if (field.type === "password") {
    field.type = "text";
    icon.classList.remove("bi-eye");
    icon.classList.add("bi-eye-slash");
  } else {
    field.type = "password";
    icon.classList.remove("bi-eye-slash");
    icon.classList.add("bi-eye");
  }
}
</script>
{% endblock %}
